# ClarifyAI — Company Document Insight Assistant

Internal, role-aware RAG assistant that delivers citation-backed answers from approved company documents using AWS Bedrock, S3 Vector Store Serverless, and a serverless AWS backend.

---

## Table of Contents

- [Overview](#overview)
- [Key Features](#key-features)
- [Architecture Overview](#architecture-overview)
- [System Implementation](#system-implementation)
  - [Landing & Sign-In](#landing--sign-in)
  - [Admin Workflow](#admin-workflow)
  - [Employee Workflow](#employee-workflow)
- [Technology Stack](#technology-stack)
  - [Cloud Services](#cloud-services)
  - [Frontend Stack](#frontend-stack)
  - [DevOps](#devops)
- [AWS Modules & Configurations](#aws-modules--configurations)
  - [Amplify-Hosted React UI](#amplify-hosted-react-ui)
  - [Amazon Cognito (User Pool + Identity Pool)](#amazon-cognito-user-pool--identity-pool)
  - [Amazon API Gateway](#amazon-api-gateway)
  - [AWS Lambda](#aws-lambda)
  - [Bedrock Knowledge Base & S3 Vector Store](#bedrock-knowledge-base--s3-vector-store)
  - [Amazon S3](#amazon-s3)
- [Security & IAM](#security--iam)
- [CI/CD via Amplify](#cicd-via-amplify)
- [Outcomes](#outcomes)
- [Challenges & Lessons Learned](#challenges--lessons-learned)
- [Future Roadmap](#future-roadmap)
- [Team](#team)
- [Acknowledgements](#acknowledgements)

---

## Overview

ClarifyAI is an internal, role-aware question-answering system designed for organizations that maintain **controlled knowledge bases**. Employees can ask natural-language questions and receive **precise, citation-backed responses** derived exclusively from **sanctioned documents**.

The solution adopts a **Retrieval-Augmented Generation (RAG)** pattern on AWS:

- Documents stored in **Amazon S3**
- Ingested by **Bedrock Knowledge Bases**
- Indexed into **S3 Vector Store Serverless**
- Answers generated by **Bedrock foundation models** via **Bedrock Flows**

A **React UI** hosted on **AWS Amplify** and secured with **Amazon Cognito** provides:

- Role-based access (Admin vs Employee)
- A simple query interface
- Low operational overhead

---

## Key Features

- **Grounded responses with citations**  
  - Retrieves relevant passages before generation.  
  - Displays sources for transparency and auditability.

- **Role-based access (RBAC)**  
  - **Admins** can upload and sync documents.  
  - **Employees** can only query.  
  - UI adapts based on Cognito group.

- **Secure, low-ops stack**  
  - Cognito for authentication and authorization.  
  - API Gateway + Lambda as a thin, auditable API layer.  
  - S3 Vector Store Serverless as a cost-effective semantic index.  
  - Amplify Hosting for fast, repeatable deployments.

- **Observability**  
  - CloudWatch logs for API & Lambda.  
  - Visible Knowledge Base Sync status in the Admin UI.

---

## Architecture Overview

ClarifyAI follows a **layered RAG architecture** for robustness and security:

1. **User Authentication & UI**  
   - React frontend hosted on **AWS Amplify**  
   - **Amazon Cognito** for sign-in and sign-out  
   - Group-aware UI (Admin vs Employee)

2. **Secure API Endpoint**  
   - **Amazon API Gateway** fronting minimal **AWS Lambda** functions  
   - Validates Cognito tokens with a Cognito authorizer  
   - Lambda orchestrates RAG with Bedrock and returns `{ response, execution_id, metadata }`

3. **RAG Engine (Retrieval & Generation)**  
   - **Bedrock Knowledge Base** ingests from S3, chunks documents, and creates embeddings  
   - Embeddings stored in **S3 Vector Store Serverless**  
   - **Bedrock Flow** combines KB retrieval and foundation model for retrieve-and-generate

4. **Source of Truth & Vector Index**  
   - **Amazon S3** is the authoritative corpus (encrypted at rest)  
   - S3 Vector Store Serverless provides k-NN semantic retrieval over embeddings
  
`![System Architecture](images/System Architecture.png)`

---

## System Implementation

ClarifyAI consists of:

- A **content onboarding path**  
  Admin → S3 → KB Sync → S3 Vector Store

- A **secure query path**  
  User → Cognito → API Gateway → Lambda → Bedrock Flow


### Landing & Sign-In

- Landing page with ClarifyAI branding and options to sign in as **Admin** or **User**.  
- Sign-in uses **Amazon Cognito** (React + Amplify + Hosted UI).  
- New users are assigned to **Admins** or **Users** groups.

### Admin Workflow

Securely managing the knowledge corpus.

1. **Authenticate & Upload**
   - Admin signs in via Amplify UI (Cognito).  
   - Identity Pool issues temporary IAM credentials with **S3 write access**.  
   - Admin uploads documents (PDF, DOCX, etc.) through the dashboard to the ClarifyAI S3 bucket.

2. **Synchronize Knowledge Base**
   - Admin clicks **Sync** in the UI.  
   - Bedrock Knowledge Base crawls S3, chunks documents, and generates embeddings.

3. **Index Vectors & Verify**
   - Embeddings are written to **S3 Vector Store Serverless**.  
   - New content becomes available for queries.  
   - Admin can run a quick test query to confirm ingestion.

### Employee Workflow

Querying for trusted, verifiable insights.

1. **Authenticate & Query**
   - Employee signs in via Amplify UI (Cognito).  
   - UI presents a simple Q&A interface (no upload options).

2. **Secure API Call**
   - React app sends a POST request to **API Gateway** (`/query`) with the Cognito ID token in `Authorization`.  
   - API Gateway validates the token using a **Cognito Authorizer** and invokes Lambda.

3. **Retrieve, Generate & Respond**
   - Lambda calls **Bedrock Flow** with the user’s question.  
   - The Flow retrieves top-k chunks from the **Knowledge Base + S3 Vector Store**.  
   - A foundation model generates an answer using the retrieved context.  
   - The response (answer + citations + metadata) is returned to the UI and rendered for the user.

---

## Technology Stack

### Cloud Services

- **Amazon S3** – Document storage and source of truth  
- **S3 Vector Store Serverless** – Vector index for semantic retrieval  
- **Amazon Bedrock** – Knowledge Bases, foundation models, and Flows  
- **AWS Lambda (Python 3.11/3.13)** – Serverless compute for query and upload handlers  
- **Amazon API Gateway** – Secured REST API (`/query`, `/upload`)  
- **Amazon Cognito** – User Pool & Identity Pool for authentication and authorization  
- **AWS Amplify Hosting** – Frontend hosting and CI/CD

### Frontend Stack

- **React** single-page application  
- **aws-amplify** for Auth + API integration  
- **@aws-amplify/ui-react** for `<Authenticator />` and UI components

### DevOps

- Git repository integrated with **Amplify CI/CD**  
- **Environment variables** for API URLs, Cognito IDs, Knowledge Base IDs, etc.

---

## AWS Modules & Configurations

### Amplify-Hosted React UI

Deployed frontend for Admin/User dashboards and Q&A.

**Configuration (summary):**

- Push the ClarifyAI React app to a Git repository (main branch).  
- In **AWS Amplify → Host web app**, connect the repository and select the branch.  
- Accept default React build commands (`npm ci` / `npm install` + `npm run build`).  
- Add environment variables for Cognito IDs, API URL, and region.  
- Configure SPA rewrites so all routes go to `/index.html`.  
- Deploy and verify the Amplify app URL.  
- Use `aws-exports.js` and `Amplify.configure(awsExports)` in React so `<Authenticator />` and `API` calls work.

---

### Amazon Cognito (User Pool + Identity Pool)

Managed user directory and scoped AWS credentials.

**Configuration (summary):**

- Create a **User Pool** for ClarifyAI with email as sign-in username.  
- Create an **App Client** (no client secret) and set redirect URLs to your Amplify domain.  
- Define groups:
  - `Admins` – upload + query  
  - `Users` – query-only  
- Create an **Identity Pool** that uses this User Pool as the auth provider.  
- Create IAM roles for Admins and Users:
  - Admin role: S3 `PutObject` permissions on the documents bucket  
  - User role: read/query only  
- Map `Admins` group to the Admin IAM role in the Identity Pool.  
- Update `aws-exports.js` with User Pool ID, App Client ID, Identity Pool ID, and region.

**Maintenance:** Whenever documents change or new ones are added, re-sync the Knowledge Base to create new embeddings.  
Sequence: **upload → Sync → quick test**.

---

### Amazon API Gateway

Managed API front door with authorizers and CORS.

**Configuration (summary):**

- Create an HTTP or REST API named `ClarifyAIAPI`.  
- Add a `POST /query` route integrated with `RAGQueryFunction` (Lambda proxy).  
- Add a `POST /upload` route integrated with `DocumentUploadHandler` (Lambda proxy).  
- Create a **Cognito Authorizer** pointing to the ClarifyAI User Pool; token source = `Authorization` header.  
- Require the authorizer on both `/query` and `/upload`.  
- Enable CORS for the Amplify domain: `POST, OPTIONS` methods and `Authorization, Content-Type` headers.  
- Deploy to a stage (e.g., `prod`) and use the invoke URL in the frontend configuration.

**Response contract from Lambda:**

```json
{
  "response": "The generated text answer from Bedrock Flow goes here.",
  "execution_id": "exec-123456789",
  "metadata": {
    "completion_reason": "SUCCESS"
  }
}

---

### AWS Lambda

  Backend logic for RAG queries and document uploads. 

**RAGQueryFunction**

* Runtime: Python 3.11/3.13
* Reads question from `event.body`.
* Invokes Bedrock Flow and returns:

```json
{
  "statusCode": 200,
  "headers": { "Access-Control-Allow-Origin": "...", "...": "..." },
  "body": "{\"response\": \"...\", \"execution_id\": \"...\", \"metadata\": {\"completion_reason\": \"SUCCESS\"}}"
}
```

**DocumentUploadHandler**

* Runtime: Python 3.13
* Env: `S3_BUCKET_NAME`, `KNOWLEDGE_BASE_ID`, `DATA_SOURCE_ID`
* Accepts base64 file content, writes to `documents/` in S3, and calls `start_ingestion_job` on the KB.
* Optionally lists existing documents via `list_objects_v2` + `head_object`.

### Bedrock Knowledge Base & S3 Vector Store

  Ingestion, chunking, embeddings, and semantic retrieval. 

**Knowledge Base core settings:**

* Name: `knowledge-base-clarifyai-s3vectorSt-6fino`
* RAG type: **Vector store**
* Data Source: S3 `documents/` prefix
* Chunking: fixed, 512 tokens
* Embeddings: Titan Text Embeddings V2 (1024-dim float vectors)
* Vector Store: Amazon S3 Vectors (Preview), index ARN stored in config.

**S3 Vector Store:**

* Vector Store Index ARN:
  `arn:aws:s3vectors:us-east-1:353833416570:bucket/bedrock-knowledge-base-r302k9/index/bedrock-knowledge-base-default-index`
* Data source object: `knowledge-base-clarifyai-s3vectorSt-gcbyn-data-source`

### Amazon S3

  Authoritative document corpus + KB artifacts. 

* Bucket: `clarifyai-kb-s3vector`
* Region: `us-east-1`
* Encryption: SSE-S3 + bucket key
* Public access: fully blocked
* Documents stored under `documents/` with metadata (filename, timestamp).
* Bucket policy grants limited `s3:PutObject` and `s3:GetObject` to specific IAM roles.

---

## Security & IAM

ClarifyAI answers policy-relevant questions, so access control is critical. 

* **Least privilege**

  * Dedicated roles for: Lambda, Bedrock Flows/KB, API logging, S3 ops.
* **Group-based access**

  * `Admin` vs `User` groups in Cognito drive UI and backend permissions.
* **Credential isolation**

  * Identity Pool grants temporary **S3 write** only to Admins.
* **API safeguards**

  * API Gateway Cognito authorizer validates tokens; unauthorized calls → 401/403.
* **Data protection**

  * S3 encryption at rest, TLS in transit, CloudTrail for audit logs.

  *See IAM roles table in the report for full list of roles and policies.* 

---

## CI/CD via Amplify

ClarifyAI uses **Amplify Hosting** for build & deploy: 

1. **Git Commit & Push** – Developers push to `main` or feature branches.
2. **Amplify Build** – Runs install, test (optional), and React build.
3. **Deploy** – Ships to a CloudFront-backed domain with HTTPS.
4. **Rollback** – Previous deployments can be restored with zero downtime.

---

## Outcomes



* Built a functioning **RAG-based web application** with Admin upload + Employee query.
* Achieved **citation-backed answers** grounded only in S3-hosted documents.
* Demonstrated **secure, role-aware access** using Cognito + IAM.
* Reduced vector database cost by switching from OpenSearch to **S3 Vector Store Serverless**.

---

## Challenges & Lessons Learned

### Challenges

* Complex, cross-service IAM role design.
* Cost accumulation with always-on **OpenSearch Serverless**.
* End-to-end integration of Cognito → Amplify → API Gateway → Lambda → Bedrock.

### Key Lessons 

* Cloud projects require many small, precise IAM roles; permissions must be explicit for each interaction.
* S3 Vector Store is far more cost-effective for **cold RAG corpora** than persistent OpenSearch.
* Bedrock Flow provides a useful visual way to chain KB retrieval and prompts.
* Amplify significantly simplifies Cognito integration and token handling in React.

---

## Future Roadmap



* Automated KB Sync on S3 upload events.
* Multi-language support.
* Fine-grained, document-level permissions.
* Cost-anomaly detection and alerts.
* Richer analytics and search insights for admins.
* Integrations with Slack / Microsoft Teams.

---

## Team

**1726 Group 2** 

* 700771333 – Ghattamaneni Likhitha
* 700773763 – Komatlapalli Venkata Naga Sri
* 700772413 – Nidhin Ninan
* 700763677 – Rohini Patturaja

---

## Acknowledgements

Thank you for giving us the opportunity to design and build this project and to work hands-on with AWS services. Being able to configure and integrate services like Cognito, API Gateway, Lambda, Bedrock, S3, and Amplify has significantly deepened our understanding of cloud-native architectures and retrieval-augmented generation. This hands-on experience has been extremely valuable for our technical growth and has helped us connect classroom concepts with real-world implementation.


